comment { Create host interface }
create host-interface name vpp1out
set int state host-vpp1out up
set int ip address host-vpp1out 10.10.1.2/24
enable ip6 interface host-vpp1out
set int ip address host-vpp1out 2001:f1::2/126


comment { -- Create vpp connected interface 1 - 2 }
create memif socket id 1 filename /run/vpp/socketvpp1_2.sock
create interface memif id 0 socket-id 1 master
set int state memif1/0 up
set int ip address memif1/0 10.10.2.1/24
enable ip6 interface memif1/0
set int ip address memif1/0 2001:f2::1/126
set interface mac address memif1/0 aa:bb:cc:dd:ee:01

ip route add 10.10.3.0/24 via 10.10.2.2
ip route add 2001:f3::0/126 via 2001:f2::2

ip route add 10.11.4.0/24 via 10.10.2.2
ip route add 2001:f4::0/126 via 2001:f2::2

comment { -- Create loopback }
# create loopback interface
# set int state loop0 up
# set int ip address loop0 10.10.11.1/32
# enable ip6 interface loop0
# set int ip address loop0 2001:fdd1::1/128

comment { ipfix using flowprobe -> by default monitoring TX from interface: memif1/0 }
# set ipfix exporter collector 10.11.4.1 src 11.11.11.11 template-interval 5
# flowprobe params record l3 active 5 passive 5
# flowprobe feature add-del memif1/0 ip6 tx
# # flowprobe feature add-del host-vpp1out ip6 rx

# pcap dispatch trace on max 10000 file vppcapture.pcap buffer-trace dpdk-input 100

comment { IOAM encapsulation node }
# 586 is the index of the node ip6-lookup
classify table miss-next ip6-node ip6-lookup mask l3 ip6 dst
# 569 is the index of the node ip6-add-hop-by-hop
classify session acl-hit-next ip6-node ip6-add-hop-by-hop table-index 0 match l3 ip6 dst 2001:f4::1
set int input acl intfc host-vpp1out ip6-table 0

set ioam-trace profile trace-type 0x1f trace-elts 3 trace-tsp 1 node-id 0x1 app-data 0x1234

# set ioam export ipfix collector 10.11.4.1 src 11.11.11.11 

set ioam rewrite trace

# set udp-ping src 2001:f1::2 src-port-range 4000:4010 dst 2001:f4::1 dst-port-range 4011:4020 interval 10
